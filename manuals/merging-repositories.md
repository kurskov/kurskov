# Объединение репозиториев

Метод для объединения нескольких репозиториев в один с сохранением истории изменений.  
Все действия лучше проводить локально на клонах.

### Подготавливаем репозитории для переноса
Создаем внутри каждого переносимого репозитория каталог для переноса и переносим туда все его содержимое.  
В итоге внутри репозитория должен быть только этот каталог.
1. Переходим в каталог с локальным репозиторием (repo_1)
   ```
   cd repo_1
   ```
2. Создаем в нем каталог для миграции (repo_1_dir)
   ```
   mkdir -p repo_1_dir
   ```
3. Переносим все содержимое репозитория в этот каталог
   ```
   git mv -k * repo_1_dir
   ```
4. Комитим созданные измененния
   ```
   git commit -m "Move all files to subdir"
   ```

### Создаем итоговый репозиторий
Или можно воспользоваться уже имеющимся проектом.
1. Создаем каталог для итогового репозитория (united_repo)
   ```
   mkdir united_repo
   ```
2. Преходим в него
   ```
   cd united_repo
   ```
3. Инициализируем его как репозиторий git
   ```
   git init
   ```
   
### Перенос и объединение репозиториев
Эта операция проводиться отдельно для всех переносимых репозиториев.
1. Подключаем локальные каталоги к итоговому репозиторию
   ```
   git remote add added_repo_1 ../repo_1_dir
   ```
2. Загружаем комиты подключеного репозитория
   ```
   git fetch added_repo_1
   ```
3. Объединяем master-ветки подключеного и итогового репозиториев
   ```
   git merge —allow-unrelated-histories remotes/added_repo_1/master
   ```
   
При добавление второго и последующих репозиториев во время слияния будет открываться файл MERGE_COM с описанием коммита.
В него необходимо добавить любой текст (например, "Добавление репозитория"), иначе операция прервется.
